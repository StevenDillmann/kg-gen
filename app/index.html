<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Knowledge Graph Explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="sidebar.css">
    <link rel="stylesheet" href="modal.css">
    <link
        rel="stylesheet"
        href="https://unpkg.com/simplebar@latest/dist/simplebar.css"
    />
</head>

<body>
    <!-- Mobile Top Bar -->
    <div class="mobile-top-bar">
        <button class="mobile-menu-button" id="mobileMenuButton" type="button" aria-label="Toggle navigation menu">
            <div class="hamburger-icon">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </div>
        </button>
        <header class="app-header_mobile" role="banner">
            <div class="app-header__mobile-inner">
                <div class="app-header__mobile-search" role="search" aria-label="Global search">
                    <div class="search-field-mobile">
                        <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path d="M11 4a7 7 0 1 1 0 14 7 7 0 0 1 0-14zm0 2a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm9.707 13.293-3.4-3.4a1 1 0 1 0-1.414 1.414l3.4 3.4a1 1 0 0 0 1.414-1.414z"></path>
                        </svg>
                        <input id="globalSearch-mobile" class="search-input-mobile" type="search" placeholder="Search entities, relations..." aria-label="Search" autocomplete="off" />
                    </div>
                </div>
                <button id="viewSelectionBtnMobile" class="view-selection-btn-mobile" title="View selected item">
                    <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M11.2 4c-1.26.12-2.48.53-3.56 1.2l-1-1.73A9.7 9.7 0 0 1 11 2m6.53 4.25c-.91-.86-2-1.52-3.19-1.92L15 2.39c1.5.45 2.89 1.27 4 2.39M5.34 7.41A8.3 8.3 0 0 0 4 10.83l-2-.28C2.2 9 2.79 7.5 3.7 6.23M22 12v.66l-2-.16V12c0-1.08-.19-2.14-.61-3.14l1.83-.8c.53 1.25.78 2.59.78 3.94M6 17.3l-1.5 1.31a10.46 10.46 0 0 1-2.2-4.08L4.17 14c.36 1.22.99 2.35 1.83 3.3m6.14 4.7H12c-1.5 0-3-.32-4.36-.93l.89-1.83c1.09.51 2.27.76 3.47.76h.19M17 21h-2v-6h6v2h-2.58l2.72 2.76l-1.41 1.41L17 18.5"/>
                    </svg>
                </button>
                <!-- <button id="selectorModalBtn" class="demo-dialog-btn" title="Open selector modal" style="background: #dc2626;">Selector</button> -->
                <div id="selectionPopoverMobile" class="selection-popoverMobile" role="dialog" aria-labelledby="selection-titleMobile" hidden>
                    <div class="popover-header">
                        <h3 id="selection-titleMobile">Selected Item</h3>
                        <button id="closePopoverMobile" class="close-btnMobile" aria-label="Close">&times;</button>
                    </div>
                    <div class="popover-content">
                        <div id="selectionListMobile">Click a node or relation in the network to inspect details.
                        </div>
                    </div>
                </div>
            </div>
        </header>
    </div>

    <div class="layout">
        <main class="sidebar" id="sidebar" data-simplebar>

            <div class="sidebar-header">
                <header class="sidebar-header">
                    <h1>Knowledges Graph Explorer</h1>
                </header>
                
                <div class="action-buttons-container">
                    <!-- Open Graph Button -->
                    <button class="action-btn primary-action" onclick="openGraphViewer()">
                        <svg class="action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <span class="action-title">Open Existing Graph</span>
                    </button>
                    
                    <!-- Divider Line -->
                    <!-- <div class="action-divider">
                        <div class="divider-line"></div>
                        <div class="divider-text">OR</div>
                        <div class="divider-line"></div>
                    </div> -->
           
                    <!-- Generate from Text Button -->
                    <button class="action-btn secondary-action" onclick="generateFromText()">
                        <svg class="action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                        <span class="action-title">Generate from Text</span>
                    </button>
                </div>

            </div>
            <!-- Analysis Mode Content -->
            <div class="sidebar-mode-content" id="analysisModeContent" style="display: none;">
                <div class="analysis-placeholder">
                    <p>Load or generate a graph to see analysis here.</p>
                </div>
                <div class="analysis-content" id="analysisContent" style="display: none;">
                    <div class="analysis-section">
                        <h2 class="analysis-section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M20 12a2 2 0 0 0-.703.133l-2.398-1.963c.059-.214.101-.436.101-.67C17 8.114 15.886 7 14.5 7S12 8.114 12 9.5c0 .396.1.765.262 1.097l-2.909 3.438A2.06 2.06 0 0 0 9 14c-.179 0-.348.03-.512.074l-2.563-2.563C5.97 11.348 6 11.179 6 11c0-1.108-.892-2-2-2s-2 .892-2 2s.892 2 2 2c.179 0 .348-.03.512-.074l2.563 2.563A1.906 1.906 0 0 0 7 16c0 1.108.892 2 2 2s2-.892 2-2c0-.237-.048-.46-.123-.671l2.913-3.442c.227.066.462.113.71.113a2.48 2.48 0 0 0 1.133-.281l2.399 1.963A2.077 2.077 0 0 0 18 14c0 1.108.892 2 2 2s2-.892 2-2s-.892-2-2-2z"/>
                            </svg>
                            Stats
                        </h2>
                        <div class="stats-grid" id="statsGrid"></div>
                    </div>
                    <div class="analysis-section">
                        <h2 class="analysis-section-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16">
                                <path fill="currentColor" d="M14 12a1.993 1.993 0 0 0-1.008.305L10.78 10.15a3.439 3.439 0 0 0 .74-1.993L13.09 8a1.49 1.49 0 1 0-.089-.768l-1.591.128a3.512 3.512 0 0 0-1.978-2.521L9.74 4H10a2 2 0 1 0-1.01-.265l-.27.855a3.31 3.31 0 0 0-.754-.084c-.83 0-1.59.296-2.181.789L2.791 2.291a1.5 1.5 0 1 0-1.291.71c.281-.001.544-.079.767-.214L5.26 5.791a3.446 3.446 0 0 0-.76 2.168v.203l-.66.11a2 2 0 1 0 .161.786L4 8.999l.63-.097a3.522 3.522 0 0 0 1.466 1.992l-.556 1.188a1.947 1.947 0 0 0-.539-.08h-.017a2 2 0 1 0 1.231.423l.566-1.153c.364.146.787.231 1.229.231c.847 0 1.621-.311 2.216-.824l2.176 2.124a2 2 0 1 0 1.6-.8zm-9 3a1 1 0 1 1 0-2a1 1 0 0 1 0 2zm3-4.5a2.5 2.5 0 1 1 0-5a2.5 2.5 0 0 1 0 5z"/>
                            </svg>
                            Entity Clusters
                        </h2>
                        <div id="clusterList" class="list"></div>
                    </div>
                    <div class="analysis-section">
                        <h2 class="analysis-section-title">Top Entities</h2>
                        <div id="topEntities" class="list"></div>
                    </div>
                    <div class="analysis-section">
                        <h2 class="analysis-section-title">
                            <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M12 22q-1 0-1.692-.702t-.692-1.702q0-.369.1-.691q.101-.322.29-.603l-4.308-4.294q-.28.183-.615.289q-.335.107-.685.107q-1 0-1.69-.702Q2.02 13 2.02 12t.69-1.702t1.689-.702q.879 0 1.529.553t.815 1.37h2.933q.148-.707.642-1.199q.495-.491 1.202-.64V6.749q-.817-.165-1.36-.825t-.544-1.52q0-1 .702-1.691q.702-.693 1.702-.693t1.702.693t.702 1.692q0 .35-.104.685q-.104.334-.292.615l4.289 4.288q.28-.188.615-.292t.684-.104q1 0 1.693.702Q22 11 22 12t-.692 1.702t-1.693.702q-.86 0-1.519-.543q-.66-.544-.825-1.361h-2.913q-.149.708-.65 1.202q-.5.494-1.208.642v2.927q.817.166 1.37.816t.553 1.51q0 1-.712 1.701Q13 22 12 22m-.48-4.729v-2.927q-.345-.067-.649-.232q-.304-.166-.55-.413q-.248-.247-.413-.551q-.166-.304-.233-.648H6.742q-.019.102-.05.207t-.074.21t-.092.197t-.114.18q.144.145.782.773q.639.63 1.372 1.365l1.37 1.374l.783.782q.089-.063.184-.114t.2-.095q.105-.045.21-.067t.206-.04m2.839-5.772h2.913q.02-.108.051-.213q.032-.104.076-.209t.095-.2t.115-.178q-.145-.144-.774-.783q-.628-.638-1.361-1.37q-.733-.734-1.371-1.363q-.639-.628-.783-.773q-.083.064-.178.115t-.2.095t-.21.076q-.104.032-.212.051v2.933q.339.061.645.23t.542.412t.412.541t.24.636m5.257 1.904q.58 0 .982-.403Q21 12.598 21 12q0-.579-.403-.991t-.981-.413q-.599 0-1.001.413q-.403.412-.403.991q0 .598.403 1.001q.402.403 1 .403m-7.596 0q.579 0 .991-.403T13.424 12q0-.579-.413-.991t-.99-.413q-.599 0-1.002.413q-.403.412-.403.991q0 .598.403 1.001t1.001.403m0 7.596q.579 0 .991-.413t.413-.99q0-.58-.413-.992t-.99-.413q-.599 0-1.002.413q-.403.412-.403.991t.403.991q.403.413 1.001.413m-7.596-7.596q.579 0 .991-.403T5.828 12q0-.579-.413-.991t-.991-.413t-.991.413T3.02 12q0 .598.413 1.001q.412.403.991.403m7.596-7.596q.579 0 .992-.403q.412-.403.412-1.001q0-.579-.413-.992T12.02 3q-.599 0-1.002.413q-.403.412-.403.99q0 .599.403 1.002t1.001.403"/>
                            </svg>
                            Top Relations
                        </h2>
                        <div id="topRelations" class="list"></div>
                    </div>
                </div>
            </div>

        </main>

        
        <div class="viewer-wrapper-container">
            <header class="app-header" role="banner">
                <div class="app-header__inner">
                    <div class="app-header__search" role="search" aria-label="Global search">
                        <div class="search-field">
                            <svg class="search-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                <path d="M11 4a7 7 0 1 1 0 14 7 7 0 0 1 0-14zm0 2a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm9.707 13.293-3.4-3.4a1 1 0 1 0-1.414 1.414l3.4 3.4a1 1 0 0 0 1.414-1.414z"></path>
                            </svg>
                            <input id="globalSearch" class="search-input" type="search" placeholder="Search entities, relations..." aria-label="Search" autocomplete="off" />
                        </div>
                    </div>
                    <button id="viewSelectionBtn" class="view-selection-btn" title="View selected item">
                        <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M11.2 4c-1.26.12-2.48.53-3.56 1.2l-1-1.73A9.7 9.7 0 0 1 11 2m6.53 4.25c-.91-.86-2-1.52-3.19-1.92L15 2.39c1.5.45 2.89 1.27 4 2.39M5.34 7.41A8.3 8.3 0 0 0 4 10.83l-2-.28C2.2 9 2.79 7.5 3.7 6.23M22 12v.66l-2-.16V12c0-1.08-.19-2.14-.61-3.14l1.83-.8c.53 1.25.78 2.59.78 3.94M6 17.3l-1.5 1.31a10.46 10.46 0 0 1-2.2-4.08L4.17 14c.36 1.22.99 2.35 1.83 3.3m6.14 4.7H12c-1.5 0-3-.32-4.36-.93l.89-1.83c1.09.51 2.27.76 3.47.76h.19M17 21h-2v-6h6v2h-2.58l2.72 2.76l-1.41 1.41L17 18.5"/>
                        </svg>
                        <span class="view-selection-btn-text">View selection</span>
                    </button>
                    <!-- <button id="selectorModalBtn" class="demo-dialog-btn" title="Open selector modal" style="background: #dc2626;">Selector</button> -->
                    <div id="selectionPopover" class="selection-popover" role="dialog" aria-labelledby="selection-title" hidden>
                        <div class="popover-header">
                            <h3 id="selection-title">Selected Item</h3>
                            <button id="closePopover" class="close-btn" aria-label="Close">&times;</button>
                        </div>
                        <div class="popover-content">
                            <div id="selectionList">Click a node or relation in the network to inspect details.
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <section class="viewer-wrapper">
                <iframe id="viewer" title="Knowledge Graph Explorer" hidden></iframe>
                <div class="floating-actions" id="floatingActions" hidden>
                    <button class="secondary" id="downloadGraph" type="button">Download graph.json</button>
                    <button class="secondary" id="refreshView" type="button">Reload view</button>
                </div>
            </section>
        </div>

        <!-- Modal Templates -->
        <template id="selectorModalTemplate" data-title="Template Modal Example" data-width="600px">
            <section class="card" id="existingGraphCard">
                <p>Upload a saved visualization JSON or raw <code>graph.json</code> to render it instantly.</p>
                <div class="drop-zone" id="graphDropZone" role="button" tabindex="0" aria-controls="graphFile"
                    aria-label="Upload graph JSON">
                    <strong>Drop file here or click to choose</strong>
                    <span class="hint">Accepts <code>.json</code> exports from kg-gen</span>
                </div>
                <input type="file" id="graphFile" accept="application/json,.json" hidden />
                <div class="field-group">
                    <div class="field">
                        <label for="exampleGraph">Or load a sample</label>
                        <select id="exampleGraph" disabled>
                            <option value="">Loading samples...</option>
                        </select>
                        <div class="hint" id="exampleStatus">Select an example to load it instantly.</div>
                        <a id="exampleLink" class="hint-link" href="#" target="_blank" rel="noopener" hidden>View on
                            Wikipedia</a>
                    </div>
                </div>
            </section>
        </template>

        <template id="textGeneratorModalTemplate" data-title="Text Generator" data-width="600px">
            <!-- Generate from text Mode Content -->
            <div class="sidebar-mode-content" id="generateModeContent">
                <section class="card" id="generateCard">
                    <p>Provide your OpenAI API key and either paste text or upload a <code>.txt</code> document. The request
                        runs through <code>KGGen</code> on this server.</p>

                    <div class="field-group">
                        <div>
                            <label for="apiKey">OpenAI API key</label>
                            <input type="password" id="apiKey" autocomplete="new-password" placeholder="sk-..." />
                        </div>
                        <div class="field-row">
                            <div>
                                <label for="model">Model</label>
                                <select id="model">
                                    <option value="openai/gpt-4o">openai/gpt-4o</option>
                                    <option value="openai/gpt-5-nano">openai/gpt-5-nano</option>
                                    <option value="openai/gpt-5">openai/gpt-5</option>
                                </select>
                            </div>
                            <div>
                                <label for="chunkSize">Chunk size (chars)</label>
                                <input type="number" id="chunkSize" min="0" placeholder="e.g. 1500" />
                            </div>
                        </div>
                        <div class="field-row">
                            <label class="checkbox">
                                <input type="checkbox" id="clusterToggle" />
                                <span>Enable clustering</span>
                            </label>
                            <div class="field">
                                <label for="temperature">Temperature</label>
                                <input type="number" id="temperature" step="0.1" min="0" max="2" placeholder="Default" />
                            </div>
                        </div>
                        <div>
                            <label for="context">Context (optional)</label>
                            <input type="text" id="context" placeholder="Short description of the corpus" />
                        </div>
                        <div>
                            <label for="sourceText">Paste text</label>
                            <textarea id="sourceText"
                                placeholder="Add any text you would like to convert into a knowledge graph..."></textarea>
                            <div class="input-hint" id="sourceTextHint">To enter text, clear the file selection first</div>
                        </div>
                        <div>
                            <label for="textFile">Or upload a .txt file</label>
                            <input type="file" id="textFile" accept="text/plain" />
                            <div class="input-hint" id="textFileHint">To upload a file, clear the text input first</div>
                            <div class="file-note">Files are processed on this machine and never leave your environment.
                            </div>
                        </div>
                    </div>

                    <div class="button-row">
                        <button class="primary" id="generateButton">Generate graph</button>
                        <button class="secondary" id="clearTextButton" type="button">Clear inputs</button>
                    </div>
                </section>
            </div>
        </template>

    </div>

    <script src="modal.js"></script>
    <script src="popover-selected.js"></script>
    <script src="script.js"></script>
    <script src="sidebar.js"></script>
    <script src="https://unpkg.com/simplebar@latest/dist/simplebar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@floating-ui/core@1.7.3"></script>
    <script src="https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.7.4"></script>
 
</body>

</html>